
#降噪函数，但是感觉不一定需要，先放到这里了。
from PIL import Image
from scipy.ndimage import gaussian_filter, binary_opening, binary_closing
import numpy as np
import matplotlib.pyplot as plt

def remove_noise_and_show(image_path):
    # read the picture
    img = Image.open(image_path)

    # convert the picture to gray
    img = img.convert('L')

    # change to numpy
    img_array = np.array(img)

    # blur the picture
    blurred = gaussian_filter(img_array, sigma=1)

    # Apply threshold processing for binarization, where we choose the threshold to be 10% of the image's grayscale value.
    img_binary = np.where(blurred > np.percentile(blurred, 1), 1, 0)

    # dicrease the noise
    img_binary = binary_opening(img_binary, structure=np.ones((3,3))).astype(int)
    img_binary = binary_closing(img_binary, structure=np.ones((3,3))).astype(int)
    
    # Show the image
    plt.imshow(img_binary, cmap='gray')
    plt.show()
    
    # Return the processed image
    return img_binary

# Call the function and store the returned image
binary_image = remove_noise_and_show('image/test4.jpg')